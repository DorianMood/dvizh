(this.webpackJsonpdvizh=this.webpackJsonpdvizh||[]).push([[0],{123:function(e,t,a){},202:function(e,t,a){e.exports=a(334)},334:function(e,t,a){"use strict";a.r(t);a(203),a(229),a(231),a(232),a(234),a(235),a(236),a(237),a(238),a(239),a(240),a(241),a(243),a(244),a(245),a(246),a(247),a(248),a(249),a(250),a(251),a(252),a(254),a(255),a(256),a(257),a(258),a(259),a(260),a(261),a(262),a(263),a(264),a(265),a(266),a(267),a(268),a(269),a(270),a(271);var n=a(30),c=a.n(n),r=a(42),l=a(0),o=a.n(l),i=a(134),u=a.n(i),s=a(37),m=a(24),d=a.n(m),f=a(43),p=a.n(f),b=(a(280),a(336)),E=(a(119),a(135)),v=a.n(E),h=function(){return o.a.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover"})},g=a(17),j=a(91),y=a.n(j),O=a(4),k=a(146),x=a.n(k),C=a(147),w=a.n(C),S=a(26),z=(a(294),a(123),a(70)),A=a(148),I=a.n(A),K=a(71),_=a.n(K),R=a(149),D=a.n(R),V=a(72),U=a.n(V),G=function(e){var t,a=e.event,n=Object(s.b)().router;"https://api.vk.com/method/users.get?user_id=".concat(a.user.vkId,"&fields=photo_100&v=5.52&access_token=").concat("00cbd57700cbd57700cbd577a600bb65b7000cb00cbd5775e4f88f4d93ab35ad11d762b");return o.a.createElement(O.c,{size:"l",onClick:function(){n.navigate("event",{id:a.id,event:a}),console.log("card click")}},o.a.createElement(O.e,{before:o.a.createElement(O.a,{size:32,src:null!==(t=a.user.photo)&&void 0!==t?t:null},a.user.photo?null:o.a.createElement(_.a,null)),size:"l",description:o.a.createElement("div",{style:{display:"flex"}},o.a.createElement(D.a,null),a.location.name),asideContent:o.a.createElement(o.a.Fragment,null,a.price&&0!==a.price?o.a.createElement("div",{style:{textAlign:"center",color:"green"}},o.a.createElement(U.a,{style:{margin:"0 auto"}}),Math.round(a.price)):o.a.createElement(o.a.Fragment,null),o.a.createElement("div",null,new Date(a.date).toLocaleDateString())),bottomContent:o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,a.description),o.a.createElement("div",{style:{display:"flex"}},o.a.createElement(O.b,{size:"m",onClick:function(e){e.stopPropagation(),console.log("click will participate")}},"\u041f\u043e\u0439\u0434\u0443"),o.a.createElement(O.b,{size:"m",onClick:function(e){e.stopPropagation(),console.log("hide")},mode:"secondary",style:{marginLeft:8}},"\u0421\u043a\u0440\u044b\u0442\u044c")))},a.name))},W=function(e){var t=e.filterValues,a=e.onUpdate;return o.a.createElement(O.j,null,o.a.createElement(O.w,{min:500,max:5e4,step:500,value:null===t.location?1:t.location,onChange:function(e){return a({key:"location",value:e})},top:"\u0412 \u0440\u0430\u0434\u0438\u0443\u0441\u0435 ".concat(t.location," \u043c")}),o.a.createElement(O.e,{asideContent:o.a.createElement(O.y,{defaultChecked:t.date,onChange:function(e){return a({key:"date",value:e.target.checked})}})},"\u0421\u043a\u043e\u0440\u043e"),o.a.createElement(O.e,{asideContent:o.a.createElement(O.y,{defaultChecked:t.friends,onChange:function(e){return a({key:"friends",value:e.target.checked})}})},"\u0414\u0440\u0443\u0437\u044c\u044f"),o.a.createElement(O.e,null),o.a.createElement(O.e,null))},N=function(e){var t=e.events,a=e.filter,n=e.setFilter,c=Object(l.useState)(null),r=Object(g.a)(c,2),i=r[0],u=r[1],s=Object(l.useState)(a),m=Object(g.a)(s,2),d=m[0],f=m[1];Object(l.useEffect)((function(){f(a)}),[a]);var p=t.filter((function(e){return e})),b=o.a.createElement(O.q,{activeModal:i,onClose:function(){u(null),n(d),p=t.filter((function(e){return e}))}},o.a.createElement(O.o,{id:"main-modal",header:o.a.createElement(O.p,null,o.a.createElement(O.C,{level:"2"},"\u0424\u0438\u043b\u044c\u0442\u0440\u044b")),dynamicContentHeight:!0},o.a.createElement(W,{filterValues:d,onUpdate:function(e){var t=e.key,n=e.value;f(Object(S.a)(Object(S.a)({},a),{},Object(z.a)({},t,n)))}})));return o.a.createElement(O.E,{modal:b},o.a.createElement(O.l,{separator:"hide",header:o.a.createElement(O.f,{before:o.a.createElement(I.a,null),onClick:function(){u("main-modal")}},"\u0424\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c")},o.a.createElement(O.d,null,p.map((function(e,t){return o.a.createElement(G,{key:t,event:e})})))))},P=function(e){var t=e.rating,a=e.user;return console.log("User : ",a),o.a.createElement(O.v,{className:"user-profile-header",disabled:!0,multiline:!0,before:o.a.createElement(O.a,{size:72,src:null!==a?a.photo_200:null},null===a?o.a.createElement(_.a,null):null),text:o.a.createElement(O.g,{className:"user-profile-satisfied"},t.map((function(e,t){return o.a.createElement(O.g,{className:"user-profile-satisfied-col",key:t},o.a.createElement(O.C,{level:"2"},e.key),o.a.createElement(O.C,{level:"3"},e.value))})))},o.a.createElement(O.C,{level:"2",weight:"regular"},null!==a?"".concat(a.first_name," ").concat(a.last_name):"\u041d\u0438\u043a\u0438\u0442\u0430 \u0414\u043e\u043b\u0433\u043e\u0448\u0435\u0438\u043d"))},F=a(150),B=a.n(F),L=function(){var e=Object(s.b)().router;return o.a.createElement("div",{style:{position:"fixed",left:24,bottom:64,zIndex:100},onClick:function(){return e.navigate("create")}},o.a.createElement(O.a,{style:{background:"var(--button_primary_background)"}},o.a.createElement(B.a,{fill:"var(--button_primary_foreground)"})))},X=a(151),H=a(152),M=function(){function e(t,a,n){Object(X.a)(this,e),this.location=t,this.date=a}return Object(H.a)(e,[{key:"update",value:function(e){this[e.key]=e.value}}]),e}(),T=a(73),q=a.n(T),J=Object(l.createContext)(),Q=function(e){var t=e.children,a=Object(l.useState)(),n=Object(g.a)(a,2),c=n[0],r=n[1];return console.log(c),Object(l.useEffect)((function(){q.a.app().auth().onAuthStateChanged((function(e){r(e)}))}),[]),o.a.createElement(J.Provider,{value:c},t)},Y=function(e){Object(l.useContext)(J);var t=p.a.database(),a=Object(l.useState)(!0),n=Object(g.a)(a,2),i=n[0],u=n[1],s=Object(l.useState)(null),m=Object(g.a)(s,2),f=m[0],b=m[1],E=Object(l.useState)([]),v=Object(g.a)(E,2),h=v[0],j=v[1],y=Object(l.useState)(new M(0,null)),k=Object(g.a)(y,2),x=k[0],C=k[1];return Object(l.useEffect)((function(){function e(){return(e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.send("VKWebAppGetUserInfo");case 2:t=e.sent,b(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}d.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}})),function(){e.apply(this,arguments)}()}),[t]),Object(l.useEffect)((function(){t.ref("events").on("value",(function(e){var t=Object.entries(e.val()).map((function(e){return Object(S.a)({id:e[0]},e[1])}));j(t),u(!1)}))}),[t]),i?o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:"100%"}},o.a.createElement(O.u,{size:"large"})):o.a.createElement(O.r,null,o.a.createElement(P,{user:f,rating:[{key:"\ud83d\ude0a",value:101},{key:"\ud83d\ude34",value:11},{key:"\ud83d\ude0d",value:35},{key:"\ud83e\udd2c",value:4}]}),o.a.createElement(N,{events:h,filter:x,setFilter:C}),o.a.createElement(L,null))},Z=a(153),$=a(29),ee=function(e){var t=p.a.database(),a=Object(l.useState)(!0),n=Object(g.a)(a,2),i=n[0],u=n[1],s=Object(l.useState)([]),m=Object(g.a)(s,2),f=m[0],b=m[1],E=Object(l.useState)([56.85,60.6]),v=Object(g.a)(E,2),h=v[0],j=v[1],y=Object(l.useState)(new M(0,null)),k=Object(g.a)(y,2),x=k[0],C=k[1];Object(l.useEffect)((function(){function e(){return(e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.send("VKWebAppGetGeodata");case 2:t=e.sent,j([t.lat,t.long]);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}d.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}})),function(){e.apply(this,arguments)}()}),[]),Object(l.useEffect)((function(){t.ref("events").on("value",(function(e){var t=Object.entries(e.val()).map((function(e){return Object(S.a)({id:e[0]},e[1])}));b(t),u(!1)}))}),[t]);var w=f.filter((function(e){if(x.location&&Object(Z.getDistance)({latitude:e.location.lat,longitude:e.location.lng},{latitude:h[1],longitude:h[0]})<=x.location)return!0;return!1}));return i?o.a.createElement("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},o.a.createElement(O.x,{size:"large",style:{marginTop:20}})):o.a.createElement(O.r,null,o.a.createElement(O.g,{style:{height:"240px",padding:0}},o.a.createElement($.d,null,o.a.createElement($.b,{defaultState:{center:h,zoom:10},width:"100%"},o.a.createElement($.c,{geometry:h,options:{preset:"islands#redCircleDotIcon"}}),w.map((function(e,t){var a=[e.location.lng,e.location.lat];return o.a.createElement($.c,{key:t,geometry:a})})),o.a.createElement($.a,{geometry:[h,x.location]})))),o.a.createElement(N,{events:w,filter:x,setFilter:C}))},te=a(74),ae=a.n(te),ne=a(154),ce=a.n(ne),re=a(155),le=a.n(re),oe=function(e){var t=Object(s.c)("event").route.params,a=t.id,n=t.event,c=Object(l.useState)(n),r=Object(g.a)(c,2),i=r[0],u=r[1],m=q.a.database();if(Object(l.useEffect)((function(){n||m.ref("events/".concat(a)).on("value",(function(e){u(e.val())}))}),[m,a,n]),!i)return o.a.createElement(O.x,{size:"large"});return o.a.createElement(O.r,{id:a},o.a.createElement(O.s,{left:o.a.createElement(O.t,{onClick:function(){window.history.back()}},o.a.createElement(ae.a,null)),right:o.a.createElement(O.t,{onClick:function(){}},o.a.createElement(ce.a,null))},o.a.createElement("h5",null,i.name)),o.a.createElement(O.g,{style:{height:"240px",padding:0}},o.a.createElement($.d,null,o.a.createElement($.b,{defaultState:{center:[i.location.lng,i.location.lat],zoom:10},width:"100%"},o.a.createElement($.c,{geometry:[i.location.lng,i.location.lat],options:{preset:"islands#geolocationIcon"}})))),o.a.createElement(O.l,{header:o.a.createElement(O.m,{mode:"secondary"},"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435")},o.a.createElement(O.e,{multiline:!0,size:"l"},i.description)),o.a.createElement(O.l,{header:o.a.createElement(O.m,{mode:"secondary"},"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f")},o.a.createElement("div",{style:{backgroundImage:"url(https://api.parkseason.ru/images/styles/1200_500/d2/af/30e62fddc14c05988b44e7c02788e18759dce9c49e9cc281915310.jpg)",height:"200px",display:"flex",alignItems:"flex-end",justifyContent:"center",paddingBottom:"6px",borderRadius:12}},o.a.createElement(O.D,{photos:["https://sun9-12.userapi.com/c851016/v851016587/119cab/ai0uN_RKSXc.jpg?ava=1","https://sun9-12.userapi.com/c851016/v851016587/119cab/ai0uN_RKSXc.jpg?ava=1","https://sun9-12.userapi.com/c851016/v851016587/119cab/ai0uN_RKSXc.jpg?ava=1"],size:"m",layout:"vertical",style:{color:"#fff"}},"1337 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432")),o.a.createElement(O.g,{style:{display:"flex"}},o.a.createElement(O.g,{style:{flex:"1 1 auto",display:"flex",justifyContent:"center"}},o.a.createElement(U.a,{style:{margin:"-2px 10px 0 0"},fill:"green"})," ",i.price),o.a.createElement(O.g,{style:{flex:"1 1 auto",display:"flex",justifyContent:"center"}},o.a.createElement(le.a,{style:{margin:"-2px 10px 0 0"}}),new Date(i.date).toLocaleDateString())),o.a.createElement(O.g,null,o.a.createElement(O.b,{stretched:!0,mode:"commerce",style:{padding:"10px"},onClick:function(){console.log("SUBSCRIBE")}},"\u041f\u043e\u0439\u0434\u0443")),o.a.createElement(O.g,null,o.a.createElement(O.b,{stretched:!0,mode:"destructive",style:{padding:"10px"},onClick:function(){m.ref("events/".concat(a)).remove().then((function(){console.log("removed"),window.history.back()}))}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))))},ie=a(156),ue=a.n(ie),se=function(){Object(l.useContext)(J);var e=Object(l.useState)({vkId:"dorianmood",photo:""}),t=Object(g.a)(e,2),a=t[0],n=t[1],i=p.a.database(),u=Object(l.useRef)(),s=Object(l.useRef)(),m=Object(l.useRef)(),f=Object(l.useRef)(),b=Object(l.useState)({name:"\u041c\u0435\u0441\u0442\u043e",coordinates:[56.8389,60.605192]}),E=Object(g.a)(b,2),v=E[0],h=E[1],j=Object(l.useState)([56.8389,60.605192]),y=Object(g.a)(j,2),k=y[0],x=y[1],C=Object(l.useState)({name:"Event name",description:"",price:0,location:{name:v.name,lng:v.coordinates[0],lat:v.coordinates[1]},date:Date.now(),user:a}),w=Object(g.a)(C,2),z=w[0];w[1];Object(l.useEffect)((function(){function e(){return(e=Object(r.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.send("VKWebAppGetGeodata");case 2:return t=e.sent,x([t.lat,t.long]),e.next=6,d.a.send("VKWebAppGetUserInfo");case 6:a=e.sent,n({vkId:a.id,photo:a.photo_200});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(l.useEffect)((function(){var e="https://geocode-maps.yandex.ru/1.x/?apikey=".concat("0660ba4c-e52e-4ada-a9fa-9ce9df0ea9f8","&geocode=").concat([v.coordinates[1],v.coordinates[0]].join(","),"&format=json");fetch(e).then((function(e){return e.json()})).then((function(e){h(Object(S.a)(Object(S.a)({},v),{},{name:e.response.GeoObjectCollection.featureMember[0].GeoObject.name}))}))}),[v.coordinates]);var A=function(){var e=Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("PAYLOAD : ",Object(S.a)(Object(S.a)({},z),{},{name:u.current.value,price:s.current.value,picture:"",description:f.current.value,location:{name:v.name,lng:v.coordinates[0],lat:v.coordinates[1]},user:a})),i.ref("events").push(Object(S.a)(Object(S.a)({},z),{},{name:u.current.value,price:s.current.value,picture:"",description:f.current.value,location:{name:v.name,lng:v.coordinates[0],lat:v.coordinates[1]},user:a}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o.a.createElement(O.r,null,o.a.createElement(O.s,{left:o.a.createElement(O.t,{onClick:function(){window.history.back()}},o.a.createElement(ae.a,null))},"\u041e\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435"),o.a.createElement(O.j,null,o.a.createElement(O.k,{top:v.name},o.a.createElement(O.g,{style:{height:"150px"}},o.a.createElement($.d,null,o.a.createElement($.b,{defaultState:{center:v.coordinates,zoom:10},height:"150px",width:"100%",onClick:function(e){h(Object(S.a)(Object(S.a)({},v),{},{coordinates:e.get("coords")}))}},o.a.createElement($.c,{geometry:k,options:{preset:"islands#redCircleDotIcon"}}),o.a.createElement($.c,{geometry:v.coordinates}))))),o.a.createElement(O.n,{top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",getRef:u}),o.a.createElement(O.i,{top:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u043e\u0442\u043e",getRef:m,before:o.a.createElement(ue.a,null),controlSize:"l"},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0433\u0430\u043b\u0435\u0440\u0435\u044e"),o.a.createElement(O.n,{type:"date"}),o.a.createElement(O.n,{top:"\u0426\u0435\u043d\u0430",getRef:s,type:"number",defaultValue:0}),o.a.createElement(O.B,{top:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",getRef:f,defaultValue:0}),o.a.createElement(O.b,{size:"xl",onClick:function(){A().then((function(){window.history.back()}))}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")))},me=[{id:"me",text:"\u041c\u043e\u0438",icon:o.a.createElement(x.a,null)},{id:"location",text:"\u0420\u044f\u0434\u043e\u043c",icon:o.a.createElement(w.a,null)}],de=function(){var e=Object(s.b)().route,t=Object(l.useState)(null),a=Object(g.a)(t,2),n=a[0],c=a[1],r=Object(s.d)(),i=me.filter((function(t){return t.id===e.name}))[0],u=i?i.id:me[0].id;if(Object(l.useEffect)((function(){c(u)}),[u]),"event"===e.name)return o.a.createElement(oe,null);if("create"===e.name)return o.a.createElement(se,null);var m=function(e){var t=e.currentTarget.dataset.story;r.navigate(t),c(t)},d=o.a.createElement(O.z,null,me.map((function(e,t){return o.a.createElement(O.A,{onClick:m,selected:n===e.id,"data-story":e.id,text:e.text,key:t},e.icon)})));return o.a.createElement(O.h,{activeStory:n,tabbar:d},o.a.createElement(y.a,{id:"me",key:"0"},o.a.createElement(Y,null)),o.a.createElement(y.a,{id:"location",key:"1"},o.a.createElement(ee,null)))};v.a.config();var fe=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(h,null),o.a.createElement(de,null))},pe=a(60),be=a(158),Ee=[{name:"main",path:"/"},{name:"me",path:"/me"},{name:"friends",path:"/friends"},{name:"location",path:"/location"},{name:"event",path:"/event/:id"},{name:"user",path:"/user/:id"},{name:"create",path:"/create"}];d.a.send("VKWebAppInit");var ve=function(){var e=Object(pe.b)(Ee,{defaultRoute:"me"});return e.usePlugin(Object(be.a)({useHash:!0})),e}();p.a.initializeApp({apiKey:"AIzaSyAx35YiAGmieyNOqdsHerhj3CeQQGkIKX4",projectId:"dvizh-94592",databaseURL:"https://dvizh-94592.firebaseio.com",authDomain:"dvizh-94592.firebaseapp.com"}),function(){var e=Object(r.a)(c.a.mark((function e(){var t,a,n,r,l,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.send("VKWebAppStorageGet",{keys:["userUuid"]});case 2:return t=e.sent,e.next=5,d.a.send("VKWebAppGetUserInfo");case 5:if(a=e.sent,console.log("vk failed"),n=a.id,r=t.keys[0].value,console.log("DATA : ",n,r),r){e.next=15;break}return l=Object(b.a)(),r=l,e.next=15,d.a.send("VKWebAppStorageSet",{key:"userUuid",value:l}).catch((function(e){return console.log(e)}));case 15:(o=p.a.auth()).createUserWithEmailAndPassword("".concat(n,"@vk.com"),r).then((function(e){console.log("create user : OK")})).catch((function(e){console.error(e.code)})).then((function(){o.signInWithEmailAndPassword("".concat(n,"@vk.com"),r).then((function(e){console.log("login : OK")})).catch((function(e){console.log(e.code)}))}));case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),console.log("rendering index.js"),ve.start((function(){u.a.render(o.a.createElement(Q,null,o.a.createElement(s.a,{router:ve},o.a.createElement(fe,{router:ve}))),document.getElementById("root"))})),Promise.all([a.e(3),a.e(4)]).then(a.bind(null,340)).then((function(e){}))}},[[202,1,2]]]);
//# sourceMappingURL=main.125d4690.chunk.js.map